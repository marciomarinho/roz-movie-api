COMPLETE PROJECT TREE
=====================

movie_api/
├── app/                              # Main application package
│   ├── __init__.py
│   ├── main.py                       # ⭐ FastAPI app factory, lifespan, startup
│   ├── api/
│   │   ├── __init__.py
│   │   ├── routes_health.py          # Health check (GET /health)
│   │   └── routes_movies.py          # ⭐ Main API routes
│   │       ├── GET /api/movies - List with pagination & filters
│   │       ├── GET /api/movies/search - Free-text search
│   │       └── GET /api/movies/{id} - Get single movie
│   ├── core/
│   │   ├── __init__.py
│   │   ├── config.py                 # ⭐ Configuration (pydantic-settings)
│   │   └── logging_config.py         # Logging setup
│   ├── models/
│   │   ├── __init__.py
│   │   └── movie.py                  # ⭐ Pydantic models (Movie, MovieRead, PaginatedMovies)
│   ├── repositories/
│   │   ├── __init__.py
│   │   └── movies_repository.py      # ⭐ CSV loading and data access layer
│   │       ├── Loads CSV at startup
│   │       ├── In-memory storage (dict + list)
│   │       ├── list_movies() - with filters
│   │       ├── search_movies() - text search
│   │       └── get_movie_by_id()
│   ├── services/
│   │   ├── __init__.py
│   │   └── movies_service.py         # ⭐ Business logic layer
│   │       ├── get_movies() - list with pagination
│   │       ├── search_movies() - search with filters
│   │       └── get_movie() - single movie
│   └── deps/
│       ├── __init__.py
│       └── auth.py                   # ⭐ API key authentication dependency
│           └── verify_api_key() - FastAPI dependency
│
├── data/
│   └── movies.csv                    # ⭐ MovieLens CSV data file (sample included)
│
├── tests/
│   ├── __init__.py
│   └── test_movies_rest.py           # ⭐ Comprehensive test suite (40+ tests)
│       ├── TestHealthCheck
│       ├── TestListMovies
│       ├── TestSearchMovies
│       ├── TestGetMovieById
│       ├── TestRepositoryYearExtraction
│       └── TestGenreFiltering
│
├── conftest.py                       # Pytest configuration
├── requirements.txt                  # ⭐ Python dependencies
├── Dockerfile                        # ⭐ Docker image definition
├── .dockerignore
├── .gitignore
├── .env.example                      # Example environment variables
├── README.md                         # ⭐ Complete documentation
├── QUICKSTART.md                     # ⭐ Quick start guide (this file)
├── PROJECT_STRUCTURE.md              # Detailed architecture
└── TREE.txt                         # This file


⭐ = ESSENTIAL FILES


WHAT'S INCLUDED
===============

✅ REST API with 4 main endpoints
✅ Pagination and filtering (title, genre, year)
✅ Search functionality
✅ API key authentication (optional)
✅ Health check endpoint
✅ Auto-generated Swagger/ReDoc documentation
✅ Comprehensive test suite (40+ tests)
✅ Docker support with non-root user
✅ Production-ready logging
✅ Pydantic models for validation
✅ Clean architecture (routes → services → repository)
✅ Dependency injection throughout
✅ CSV data loading at startup
✅ In-memory storage for fast access
✅ Sample MovieLens data included
✅ Complete documentation


ARCHITECTURE OVERVIEW
=====================

Request Flow:
  Client Request
      ↓
  FastAPI Route Handler (routes_movies.py)
      ↓
  Dependency: verify_api_key (if enabled)
      ↓
  Get MoviesService (dependency injection)
      ↓
  MoviesService (business logic)
      ↓
  MoviesRepository (data access)
      ↓
  In-Memory Movie List
      ↓
  Filter → Paginate → Format Response
      ↓
  JSON Response to Client


Startup Flow:
  1. app/main.py creates FastAPI app
  2. FastAPI triggers lifespan startup
  3. Configuration loaded from environment variables
  4. MoviesRepository created and CSV loaded
  5. MoviesService initialized with repository
  6. Server ready to accept requests


FEATURES CHECKLIST
==================

✅ List movies with pagination
✅ Filter by title (partial, case-insensitive)
✅ Filter by genre (partial, case-insensitive)
✅ Filter by year (exact match)
✅ Search endpoint with query parameter
✅ Combine filters (title + genre + year)
✅ Get single movie by ID
✅ Return 404 for non-existent movies
✅ Return 401 for invalid API key
✅ Health check endpoint
✅ Auto-generated API docs
✅ Page size limits (max 100)
✅ Year extraction from title
✅ Genre splitting from pipe-separated string


DEPENDENCIES
============

Core:
  - fastapi==0.104.1        - Web framework
  - uvicorn==0.24.0         - ASGI server
  - pydantic==2.5.0         - Data validation
  - pydantic-settings==2.1.0 - Configuration management

Testing:
  - pytest==7.4.3           - Test framework
  - pytest-asyncio==0.21.1  - Async test support
  - httpx==0.25.2           - HTTP client for tests


DATABASE STRUCTURE (CSV)
========================

movieId | title                  | genres
--------|------------------------|----------------------------
1       | Toy Story (1995)      | Adventure|Animation|Children|Comedy|Fantasy
2       | Jumanji (1995)        | Adventure|Children|Fantasy
3       | Grumpier Old Men (1995)| Comedy|Romance
...

Parsing:
  movieId → int (primary key)
  title → string (with year extracted if present)
  genres → list[string] (split by |)


CONFIG ENVIRONMENT VARIABLES
=============================

APP_NAME              = "Movie API"
API_V1_PREFIX         = "/api"
DATA_FILE_PATH        = "./data/movies.csv"
API_KEY               = (optional - enables auth if set)
LOG_LEVEL             = "INFO"


DOCKER COMMANDS
===============

Build:
  docker build -t movielens-api:latest .

Run:
  docker run --rm -p 8000:8000 \
    -e API_KEY=secret \
    -e DATA_FILE_PATH=/app/data/movies.csv \
    movielens-api:latest

Run with Volume (use local data):
  docker run --rm -p 8000:8000 \
    -v /path/to/data:/app/data \
    movielens-api:latest

Background:
  docker run -d --restart always \
    -p 8000:8000 \
    -e API_KEY=prod-key \
    movielens-api:latest

View Logs:
  docker logs <container_id>


API EXAMPLES
============

1. List all movies (first 20):
   GET /api/movies
   
2. Get page 2 with 10 items per page:
   GET /api/movies?page=2&page_size=10
   
3. Filter by genre:
   GET /api/movies?genre=Action
   
4. Filter by title:
   GET /api/movies?title=Toy
   
5. Filter by year:
   GET /api/movies?year=1995
   
6. Combine filters:
   GET /api/movies?genre=Comedy&year=1995&page_size=50
   
7. Search:
   GET /api/movies/search?q=story
   
8. Search with additional filters:
   GET /api/movies/search?q=adventure&genre=Action&year=1995
   
9. Get single movie:
   GET /api/movies/1
   
10. With authentication:
    GET /api/movies -H "X-API-Key: mysecret"
    
11. Health check (no auth):
    GET /health


TEST EXAMPLES
=============

Run all tests:
  pytest
  
Run specific test file:
  pytest tests/test_movies_rest.py
  
Run specific test class:
  pytest tests/test_movies_rest.py::TestListMovies
  
Run specific test:
  pytest tests/test_movies_rest.py::TestListMovies::test_list_movies_default_pagination
  
Run with verbose output:
  pytest -v
  
Run with coverage:
  pytest --cov=app tests/
  
Run with coverage report:
  pytest --cov=app --cov-report=html tests/


RESPONSE EXAMPLES
=================

Success (200 OK):
{
  "items": [
    {
      "movie_id": 1,
      "title": "Toy Story (1995)",
      "year": 1995,
      "genres": ["Adventure", "Animation", "Children", "Comedy", "Fantasy"]
    }
  ],
  "page": 1,
  "page_size": 20,
  "total_items": 9742,
  "total_pages": 488
}

Not Found (404):
{
  "detail": "Movie with id 99999 not found"
}

Unauthorized (401):
{
  "detail": "Invalid API key"
}

Validation Error (422):
{
  "detail": [
    {
      "loc": ["query", "page"],
      "msg": "ensure this value is greater than or equal to 1",
      "type": "value_error.number.not_gt",
      "ctx": {"limit_value": 0}
    }
  ]
}


FILE SIZES & METRICS
====================

Project Total: ~30 KB (without node_modules or .git)
- app/ code: ~20 KB
- tests/: ~8 KB
- data/: ~2 KB
- config files: minimal

Lines of Code:
- app/: ~650 lines
- tests/: ~400 lines
- Total: ~1050 lines (well-organized, readable, documented)

Test Coverage:
- 40+ test cases
- Unit, integration, and edge case tests
- Covers all main endpoints and functionality


PRODUCTION READINESS
====================

✅ Non-root Docker user (security)
✅ Health check endpoint (Kubernetes/container orchestration)
✅ Configurable via environment variables
✅ Logging to stdout (Docker/cloud-friendly)
✅ Pagination limits (prevents abuse)
✅ Type hints throughout (code quality)
✅ Comprehensive error handling
✅ Comprehensive documentation
✅ Full test suite
✅ Clean architecture (easy to extend/maintain)


NEXT STEPS
==========

1. Download MovieLens dataset:
   https://grouplens.org/datasets/movielens/
   Place at: ./data/movies.csv

2. Run locally and test:
   pip install -r requirements.txt
   uvicorn app.main:app --reload

3. Try the API:
   curl http://localhost:8000/api/movies
   curl http://localhost:8000/docs

4. Run tests:
   pytest

5. Build Docker image:
   docker build -t movielens-api .

6. Deploy to Lightsail:
   Follow instructions in README.md


SUPPORT & DOCUMENTATION
=======================

- README.md - Complete guide, all features explained
- QUICKSTART.md - Get started in 5 minutes
- PROJECT_STRUCTURE.md - Architecture decisions
- CODE COMMENTS - Extensive docstrings
- TESTS - Working examples of all features


Questions?
==========

Check README.md section "Troubleshooting" for common issues.

Architecture explained in PROJECT_STRUCTURE.md
Code examples in QUICKSTART.md
Full API reference in README.md
